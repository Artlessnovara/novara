<div class="post-header">
    <div class="post-author">
        <img src="{{ url_for('static', filename='profile_pics/' + post.author.profile_pic) }}" alt="{{ post.author.name }}" class="profile-pic-small">
        <div class="post-author-info">
            <a href="{{ url_for('feed.profile', user_id=post.author.id) }}" style="text-decoration: none; color: inherit;">{{ post.author.name }}</a>{% if post.author.is_premium %}<span class="premium-badge" title="Premium Member"><i class="fas fa-check-circle"></i> Pro</span>{% endif %}
            <div class="post-meta">
                <span class="post-timestamp" data-timestamp="{{ post.timestamp.isoformat() }}Z">
                    {{ post.timestamp.strftime('%B %d, %Y') }}
                </span>
                &middot;
                {% if post.privacy == 'public' %}
                    <i class="fas fa-globe-americas privacy-icon" title="Public"></i>
                {% elif post.privacy == 'followers' %}
                    <i class="fas fa-user-friends privacy-icon" title="Followers"></i>
                {% else %}
                    <i class="fas fa-lock privacy-icon" title="Private"></i>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="post-more-options">
        <button class="icon-btn more-options-btn"><i class="fas fa-ellipsis-h"></i></button>
        <ul class="more-options-menu">
            <li><a href="#" class="report-post-btn" data-post-id="{{ post.id }}">Report Post</a></li>
            <!-- Add other options like 'Edit' or 'Delete' here if needed -->
        </ul>
    </div>
</div>

{% if post.content %}
<div class="post-content">
    <p>{{ post.content }}</p>
</div>
{% endif %}

{% if post.media_url %}
<div class="post-media">
    {% if post.media_type == 'image' %}
        <img src="{{ url_for('static', filename=post.media_url) }}" alt="Post image">
    {% elif post.media_type == 'video' %}
        <video src="{{ url_for('static', filename=post.media_url) }}" controls style="width: 100%;"></video>
    {% endif %}
</div>
{% endif %}

<div class="post-stats">
    <div class="reaction-summary">
        {% set total_reactions = post.reaction_summary.values()|sum %}
        {% if total_reactions > 0 %}
            {% set reaction_icons = {'like': 'ğŸ‘', 'love': 'â¤ï¸', 'haha': 'ğŸ˜‚', 'wow': 'ğŸ˜®', 'sad': 'ğŸ˜¢', 'angry': 'ğŸ˜ '} %}
            {% for r_type, count in post.reaction_summary.items()|sort(attribute=1, reverse=true)|list|first(3) %}
                <span class="reaction-icon">{{ reaction_icons.get(r_type) }}</span>
            {% endfor %}
            <span style="margin-left: 8px;">{{ total_reactions }}</span>
        {% endif %}
    </div>
    <span class="comments-count">{{ post.comments.count() }} Comments</span>
</div>

<div class="post-actions">
    <div class="action-btn-wrapper">
        <div class="reactions-palette">
            <span class="reaction-icon" data-reaction="like">ğŸ‘</span>
            <span class="reaction-icon" data-reaction="love">â¤ï¸</span>
            <span class="reaction-icon" data-reaction="haha">ğŸ˜‚</span>
            <span class="reaction-icon" data-reaction="wow">ğŸ˜®</span>
            <span class="reaction-icon" data-reaction="sad">ğŸ˜¢</span>
            <span class="reaction-icon" data-reaction="angry">ğŸ˜ </span>
        </div>
        <button class="action-btn react-btn {% if post.user_reaction %}active{% endif %}" data-user-reaction="{{ post.user_reaction or '' }}">
            {% if post.user_reaction == 'love' %}
                <i class="fas fa-heart" style="color: red;"></i> Love
            {% elif post.user_reaction %}
                <i class="fas fa-thumbs-up"></i> {{ post.user_reaction|capitalize }}
            {% else %}
                <i class="far fa-thumbs-up"></i> Like
            {% endif %}
        </button>
    </div>
    <button class="action-btn comment-btn">
        <i class="fas fa-comment"></i> Comment
    </button>
    <button class="action-btn share-btn">
        <i class="fas fa-share"></i> Share
    </button>
</div>

<div class="comments-section">
    <div class="comment-form">
        <img src="{{ url_for('static', filename='profile_pics/' + current_user.profile_pic) }}" alt="Your Profile Pic" class="profile-pic-small">
        <input type="text" class="comment-input" placeholder="Write a comment...">
        <button class="btn-primary comment-submit-btn" style="border-radius: 20px;">Post</button>
    </div>
    <div class="comments-list">
        <!-- Comments will be loaded here by JavaScript -->
    </div>
</div>
