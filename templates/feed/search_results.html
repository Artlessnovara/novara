{% extends "feed/base.html" %}

{% block title %}Search Results for "{{ query }}"{% endblock %}

{% block content %}
<div class="search-results-container" style="max-width: 900px; margin: auto; padding: 1rem;">

    {% if category %}
        <h2>Search Results for "{{ query }}" in {{ category.replace('_', ' ')|title }}</h2>
    {% else %}
        <h2>Search Results for "{{ query }}"</h2>
    {% endif %}

    {% if category == 'art_design' %}
        <div class="results-section">
            <h3>Art & Design</h3>
            <div class="works-grid">
                {% for work in results.art_design %}
                    <div class="work-item">
                        <a href="{{ url_for('feed.view_creative_work', work_id=work.id) }}">
                            <img src="{{ url_for('static', filename=work.media_url) }}" alt="{{ work.title }}">
                        </a>
                    </div>
                {% else %}
                    <p>No art & design found matching your search.</p>
                {% endfor %}
            </div>
        </div>
    {% elif category == 'writing' %}
        <div class="results-section">
            <h3>Writing</h3>
            <div class="writing-list">
                {% for work in results.writing %}
                    <div class="writing-card" style="background-color: {{ work.style_options.get('bg_color', '#ffffff') }}; color: {{ work.style_options.get('text_color', '#000000') }};">
                        <a href="{{ url_for('feed.view_creative_work', work_id=work.id) }}">
                            <h4>{{ work.title }}</h4>
                            <p>{{ work.description|truncate(150) }}</p>
                        </a>
                    </div>
                {% else %}
                    <p>No writing found matching your search.</p>
                {% endfor %}
            </div>
        </div>
    {% elif category == 'music_audio' %}
        <div class="results-section">
            <h3>Music & Audio</h3>
            {% for work in results.music_audio %}
                <div class="audio-card">
                    <!-- Using simplified audio card for search results -->
                    <a href="{{ url_for('feed.view_creative_work', work_id=work.id) }}">
                        {{ work.title }} by {{ work.artist.name }}
                    </a>
                </div>
            {% else %}
                <p>No music or audio found matching your search.</p>
            {% endfor %}
        </div>
    {% elif category == 'reels' %}
         <div class="results-section">
            <h3>Reels</h3>
            {% for reel in results.reels %}
                <div class="reel-search-item">
                     <a href="#">{{ reel.caption|truncate(80) }} by {{ reel.author.name }}</a>
                </div>
            {% else %}
                <p>No reels found matching your search.</p>
            {% endfor %}
        </div>
    {% elif category == 'challenges' %}
        <div class="results-section">
            <h3>Challenges</h3>
            {% for challenge in results.challenges %}
                <div class="challenge-search-item">
                     <a href="{{ url_for('feed.view_challenge', challenge_id=challenge.id) }}">{{ challenge.title }}</a>
                </div>
            {% else %}
                <p>No challenges found matching your search.</p>
            {% endfor %}
        </div>
    {% else %}
        <!-- Generic Search Results -->
        <div class="results-section">
            <h3>Users</h3>
            {% for user in results.users %}
                <p><a href="{{ url_for('feed.profile', user_id=user.id) }}">{{ user.name }}</a></p>
            {% else %}
                <p>No users found.</p>
            {% endfor %}
        </div>
        <div class="results-section">
            <h3>Posts</h3>
            {% for post in results.posts %}
                <p>"{{ post.content|truncate(80) }}" by {{ post.author.name }}</p>
            {% else %}
                <p>No posts found.</p>
            {% endfor %}
        </div>
        <div class="results-section">
            <h3>Communities</h3>
            {% for community in results.communities %}
                <p><a href="{{ url_for('feed.view_community', community_id=community.id) }}">{{ community.name }}</a></p>
            {% else %}
                <p>No communities found.</p>
            {% endfor %}
        </div>
    {% endif %}

</div>

<style>
    /* Add some basic styling for the search results page */
    .results-section {
        margin-bottom: 2rem;
    }
    .results-section h3 {
        border-bottom: 1px solid var(--border-color-light);
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
    }
    /* Using styles from other templates for consistency */
    .works-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 0.5rem; }
    .work-item img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
    .writing-card { padding: 1rem; border-radius: 5px; margin-bottom: 1rem; }
    .writing-card a { text-decoration: none; color: inherit; }
</style>
{% endblock %}
