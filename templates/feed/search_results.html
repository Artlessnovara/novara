{% extends "feed/base.html" %}

{% block title %}Search Results for "{{ query }}"{% endblock %}

{% block styles %}
<style>
    .search-results-container { max-width: 900px; margin: auto; padding: 1rem; }
    .tab-nav {
        display: flex;
        border-bottom: 1px solid var(--border-color-light);
        margin-bottom: 1.5rem;
    }
    .tab-link {
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        font-weight: 600;
        color: var(--secondary-text-light);
    }
    .tab-link.active {
        border-bottom-color: var(--primary-color);
        color: var(--primary-color);
    }
    .tab-panel {
        display: none;
    }
    .tab-panel.active {
        display: block;
    }
    .result-item {
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color-light);
    }
    .result-item:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="search-results-container">
    <h1>Search Results for "{{ query }}"</h1>

    <nav class="tab-nav">
        <div class="tab-link active" data-tab="all">All</div>
        <div class="tab-link" data-tab="people">People</div>
        <div class="tab-link" data-tab="posts">Posts</div>
        <div class="tab-link" data-tab="communities">Communities</div>
    </nav>

    <div id="all" class="tab-panel active">
        <h3>All Results</h3>
        {% if not users and not posts and not communities %}
            <p>No results found for "{{ query }}".</p>
        {% else %}
            {% if users %}
                <h4>People</h4>
                {% for user in users|slice(3) %}<div class="result-item"><a href="{{ url_for('feed.profile', user_id=user.id) }}">{{ user.name }}</a></div>{% endfor %}
            {% endif %}
            {% if posts %}
                <h4>Posts</h4>
                {% for post in posts|slice(3) %}<div class="result-item"><p>"{{ post.content|truncate(100) }}" by {{ post.author.name }}</p></div>{% endfor %}
            {% endif %}
            {% if communities %}
                <h4>Communities</h4>
                {% for community in communities|slice(3) %}<div class="result-item"><a href="{{ url_for('feed.view_community', community_id=community.id) }}">{{ community.name }}</a></div>{% endfor %}
            {% endif %}
        {% endif %}
    </div>

    <div id="people" class="tab-panel">
        <h3>People</h3>
        {% for user in users %}
            <div class="result-item"><a href="{{ url_for('feed.profile', user_id=user.id) }}">{{ user.name }}</a></div>
        {% else %}
            <p>No people found matching "{{ query }}".</p>
        {% endfor %}
    </div>

    <div id="posts" class="tab-panel">
        <h3>Posts</h3>
        {% for post in posts %}
            <div class="result-item"><p>"{{ post.content|truncate(100) }}" by {{ post.author.name }}</p></div>
        {% else %}
            <p>No posts found matching "{{ query }}".</p>
        {% endfor %}
    </div>

    <div id="communities" class="tab-panel">
        <h3>Communities</h3>
        {% for community in communities %}
            <div class="result-item"><a href="{{ url_for('feed.view_community', community_id=community.id) }}">{{ community.name }}</a></div>
        {% else %}
            <p>No communities found matching "{{ query }}".</p>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabLinks.forEach(link => {
        link.addEventListener('click', () => {
            // Deactivate all
            tabLinks.forEach(l => l.classList.remove('active'));
            tabPanels.forEach(p => p.classList.remove('active'));

            // Activate clicked
            link.classList.add('active');
            const tabId = link.dataset.tab;
            document.getElementById(tabId).classList.add('active');
        });
    });
});
</script>
{% endblock %}
