{% extends "base.html" %}
{% import "templates/_form_helpers.html" as forms %}

{% block title %}Create a Page - Step 2{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <h4>Create a Page (Step 2 of 4)</h4>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="card-title">Branding</h5>
                            <p>Add a profile picture and cover banner to make your page stand out.</p>
                            <form method="POST" action="{{ url_for('pages.create_page_step2') }}" enctype="multipart/form-data">
                                {{ form.hidden_tag() }}
                                <div class="form-group">
                                    {{ forms.render_field(form.profile_pic) }}
                                </div>
                                <div class="form-group">
                                    {{ forms.render_field(form.cover_banner) }}
                                </div>
                                <div class="text-right">
                                    {{ forms.render_field(form.submit, class="btn btn-primary btn-lg") }}
                                </div>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <h5>Live Preview</h5>
                            <div class="page-preview" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden;">
                                <div id="banner-preview" style="height: 150px; background-color: #eee; background-size: cover; background-position: center;"></div>
                                <div id="pic-preview-container" style="position: relative; height: 50px;">
                                    <img id="pic-preview" src="#" alt="Profile Pic Preview" style="width: 100px; height: 100px; border-radius: 50%; border: 4px solid white; position: absolute; bottom: 0; left: 20px; object-fit: cover;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const profilePicInput = document.getElementById('profile_pic');
    const coverBannerInput = document.getElementById('cover_banner');
    const picPreview = document.getElementById('pic-preview');
    const bannerPreview = document.getElementById('banner-preview');

    if (profilePicInput) {
        profilePicInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    picPreview.src = e.target.result;
                }
                reader.readAsDataURL(this.files[0]);
            }
        });
    }

    if (coverBannerInput) {
        coverBannerInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    bannerPreview.style.backgroundImage = `url(${e.target.result})`;
                }
                reader.readAsDataURL(this.files[0]);
            }
        });
    }
});
</script>
{% endblock %}
