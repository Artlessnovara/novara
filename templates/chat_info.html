{% extends "chat_layout.html" %}

{% block chat_content %}
<style>
    .info-page { padding: 15px; color: #333; }
    .info-header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
    .info-avatar { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 15px; object-fit: cover; border: 3px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .info-name { font-size: 22px; font-weight: bold; margin: 0; }
    .info-description { font-size: 14px; color: #777; margin-top: 5px; }
    .info-tabs .tab-buttons { display: flex; border-bottom: 1px solid #ddd; }
    .info-tabs .tab-btn { flex-grow: 1; padding: 10px; background: none; border: none; cursor: pointer; font-size: 16px; color: #555; border-bottom: 3px solid transparent; }
    .info-tabs .tab-btn.active { color: #007bff; border-bottom-color: #007bff; }
    .tab-pane { display: none; padding: 20px 5px; }
    .tab-pane.active { display: block; }
    .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 5px; }
    .media-grid img { width: 100%; height: 80px; object-fit: cover; border-radius: 5px; }
    .members-list { list-style: none; padding: 0; }
    .members-list li { display: flex; align-items: center; margin-bottom: 1rem; }
    .member-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 1rem; object-fit: cover; }
    .info-actions { margin-top: 20px; }
    .action-btn { display: block; width: 100%; padding: 12px; border: none; background-color: #f0f0f0; border-radius: 8px; text-align: left; font-size: 16px; margin-bottom: 10px; cursor: pointer; text-decoration: none; color: #333; }
    .action-btn i { margin-right: 10px; }
    .action-btn.report-btn, .action-btn.delete-btn { color: #dc3545; }
</style>

<div class="info-page">
    <div class="info-header">
        <a href="{{ url_for('main.chat_room', room_id=room.id) }}" class="back-btn" style="position: absolute; top: 15px; left: 15px; font-size: 20px;"><i class="fa-solid fa-arrow-left"></i></a>
        <img src="{{ url_for('static', filename=room.cover_image or 'profile_pics/default.jpg') }}" alt="{{ room.name }}" class="info-avatar">
        <h2 class="info-name">{{ room.name }}</h2>
        {% if room.description %}<p class="info-description">{{ room.description }}</p>{% endif %}
    </div>

    <div class="info-tabs">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('media')">Media</button>
            <button class="tab-btn" onclick="showTab('members')">Members</button>
            {% if user_role_in_room == 'admin' %}<button class="tab-btn" onclick="showTab('admin')">Admin</button>{% endif %}
        </div>
        <div class="tab-content">
            <div id="media" class="tab-pane active">
                <div class="media-grid">
                    {% for message in media_messages %}
                        {% if message.file_path and message.file_name.lower().endswith(('png', 'jpg', 'jpeg', 'gif')) %}
                        <img src="{{ url_for('static', filename=message.file_path) }}" alt="Shared media">
                        {% endif %}
                    {% else %}
                        <p>No media has been shared yet.</p>
                    {% endfor %}
                </div>
            </div>
            <div id="members" class="tab-pane">
                <ul class="members-list">
                    {% for member in room.members %}
                    <li>
                        <img src="{{ url_for('static', filename='profile_pics/' + member.user.profile_pic) }}" alt="{{ member.user.name }}" class="member-avatar">
                        <span>{{ member.user.name }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% if user_role_in_room == 'admin' %}
                <a href="{{ url_for('main.add_members', room_id=room.id) }}" class="action-btn"><i class="fa-solid fa-user-plus"></i> Add Members</a>
                {% endif %}
            </div>
            {% if user_role_in_room == 'admin' %}
            <div id="admin" class="tab-pane">
                <a href="{{ url_for('main.edit_group_icon', room_id=room.id) }}" class="action-btn"><i class="fa-solid fa-image"></i> Change Group Icon</a>
                <form action="{{ url_for('admin.delete_chat_room', room_id=room.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this group? This action cannot be undone.');" style="margin: 0;">
                    <button type="submit" class="action-btn delete-btn"><i class="fa-solid fa-trash-can"></i> Delete Group</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="info-actions">
        <button class="action-btn mute-btn" id="mute-btn"><i class="fa-solid fa-bell-slash"></i> Mute Notifications</button>
        <button class="action-btn report-btn" id="report-btn"><i class="fa-solid fa-flag"></i> Report Group</button>
    </div>
</div>
{% endblock %}

{% block chat_scripts %}
<script>
    function showTab(tabId) {
        document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelector(`.tab-btn[onclick="showTab('${tabId}')"]`).classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const muteBtn = document.getElementById('mute-btn');
        if (muteBtn) {
            muteBtn.addEventListener('click', () => alert('Mute functionality is not yet implemented.'));
        }

        const reportBtn = document.getElementById('report-btn');
        if (reportBtn) {
            reportBtn.addEventListener('click', () => alert('Report functionality is not yet implemented.'));
        }
    });
</script>
{% endblock %}
