{% extends "layouts/chat_layout.html" %}

{% block title %}Chats - GloobaApp{% endblock %}

{% block content %}
<!-- Top Bar -->
<header class="top-bar">
    <h1 class="app-name gradient-text">GloobaApp</h1>
    <div class="actions">
        <a href="#"><i class="fas fa-camera"></i></a>
        <a href="#"><i class="fas fa-ellipsis-v"></i></a>
    </div>
</header>

<!-- Search Bar -->
<div class="search-bar">
    <div class="search-input-wrapper">
        <i class="fas fa-search"></i>
        <input type="text" id="search-input" class="search-input" placeholder="Search Glooba">
    </div>
</div>

<!-- Tabs Row -->
<div class="tabs-row">
    <div class="tab active">
        <span>All</span>
    </div>
    <div class="tab">
        <span>Unread</span>
    </div>
    <div class="tab">
        <span>Groups</span>
    </div>
</div>

<!-- Chat Area -->
<main class="chat-area">
    {% for chat in chats %}
    <a href="{{ url_for('main.chat_room', room_id=chat.id) }}" class="chat-item" style="display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--search-bg); text-decoration: none; color: inherit;">
        <img src="{{ chat.avatar_url }}" alt="{{ chat.name }}'s avatar" style="width: 50px; height: 50px; border-radius: 50%; margin-right: 12px;">
        <div style="flex-grow: 1;">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: 600;">{{ chat.name }}</span>
                <span style="font-size: 12px; color: var(--icon-color);">{{ chat.timestamp }}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
                <span style="font-size: 14px; color: var(--icon-color);">{{ chat.last_message | truncate(30) }}</span>
                {% if chat.unread_count > 0 %}
                <span class="unread-badge" style="background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end)); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">{{ chat.unread_count }}</span>
                {% endif %}
            </div>
        </div>
    </a>
    {% else %}
    <div style="text-align: center; padding: 50px; color: var(--icon-color);">
        <p>No chats found.</p>
    </div>
    {% endfor %}
</main>

<!-- FAB -->
<a href="{{ url_for('main.create_group') }}" class="fab">+</a>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching logic
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Search functionality
        const searchInput = document.getElementById('search-input');
        const chatItems = document.querySelectorAll('.chat-item');
        searchInput.addEventListener('keyup', function() {
            const searchTerm = searchInput.value.toLowerCase();
            chatItems.forEach(item => {
                const chatName = item.querySelector('span[style*="font-weight: 600"]').textContent.toLowerCase();
                if (chatName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
</script>
{% endblock %}